# Alpine Linux test - testing a different Linux distribution
FROM alpine:3.18

# Install basic packages
RUN apk add --no-cache \
    bash \
    curl \
    git \
    sudo \
    zsh \
    vim \
    gettext

# Create a test user with sudo privileges
RUN adduser -D -s /bin/bash testuser && \
    echo 'testuser:testpass' | chpasswd && \
    echo 'testuser ALL=(ALL) NOPASSWD:ALL' >> /etc/sudoers

# Switch to test user
USER testuser
WORKDIR /home/testuser

# Copy dotfiles into container
COPY --chown=testuser:testuser . /home/testuser/dotfiles

# Set environment variables for testing
ENV GIT_EMAIL_PERSONAL=test.personal@example.com
ENV GIT_EMAIL_WORK=test.work@example.com

# Set the working directory
WORKDIR /home/testuser/dotfiles

# This should fail gracefully since we only support Ubuntu/macOS
CMD ["bash", "-c", "echo 'Testing unsupported OS detection...' && ./install.sh; echo 'Exit code:' $?"]